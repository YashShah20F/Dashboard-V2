<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS-Inspired Dashboard</title>
    <!-- Add a favicon for better browser experience -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">

    <!-- CDN imports for React, Tailwind, and other libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    
        :root {
            --primary-purple: #6c1e74;
            --light-background: #f0f4f9;
            --card-background: rgba(255, 255, 255, 0.75);
            --border-color: rgba(108, 30, 116, 0.2);
            --text-color: #374151;
            --heading-color: #1f2937;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-background);
            background-image: linear-gradient(135deg, #f0f4f9 0%, #e8edf3 100%);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background-color: var(--card-background);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            padding: 2rem;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 12px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-logo {
            font-size: 2.25rem;
            font-weight: 800;
            color: #ffffff;
            background: linear-gradient(45deg, rgba(108, 30, 116, 0.9) 0%, rgba(140, 40, 150, 0.7) 100%);
            backdrop-filter: blur(20px);
            border-radius: 1.25rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            text-align: center;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            margin-bottom: 0.75rem;
            border-radius: 0.75rem;
            color: var(--text-color);
            font-size: 1.4rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }

        .sidebar-nav-item svg {
            margin-right: 1rem;
        }

        .sidebar-nav-item:hover {
            background-color: rgba(108, 30, 116, 0.1);
            color: var(--primary-purple);
        }

        .sidebar-nav-item.active {
            background-color: var(--primary-purple);
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .main-content {
            flex-grow: 1;
            padding: 3rem;
            margin-left: 280px; /* Offset for fixed sidebar */
        }
        
        .top-level-box {
            margin-bottom: 3rem;
            padding: 3rem;
            background-color: var(--card-background);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        .top-level-box-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-purple);
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1.5rem;
            text-align: center;
        }

        .sub-box {
            padding: 2rem;
            background-color: rgba(108, 30, 116, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 1.25rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(108, 30, 116, 0.1);
        }
        .sub-box-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--heading-color);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(108, 30, 116, 0.15);
        }
        .metric-item:last-child {
            border-bottom: none;
        }
        .metric-label {
            font-size: 1.1rem;
            color: var(--text-color);
        }
        .metric-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-purple);
        }
        
        .last-updated-text {
            text-align: center;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .scorecard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .scorecard {
            display: flex;
            align-items: center;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.5) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(108, 30, 116, 0.15);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease-in-out;
        }

        .scorecard:hover {
          transform: translateY(-5px);
        }
        
        .scorecard-icon {
            width: 3.5rem;
            height: 3.5rem;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(108, 30, 116, 0.1);
            border-radius: 50%;
            margin-right: 1.5rem;
            color: var(--primary-purple);
        }
        
        .scorecard-content h3 {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 0.25rem;
        }
        
        .scorecard-content p {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--primary-purple);
        }
        
        .chart-container {
            background-color: var(--card-background);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        /* Responsive styles for mobile */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: space-around;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 1.5rem 1rem;
                position: relative;
                margin-bottom: 2rem;
            }
            .sidebar-logo {
                display: none;
            }
            .main-content {
                padding: 1.5rem;
                margin-left: 0;
            }
            .top-level-box-title {
                text-align: center;
                font-size: 2rem;
            }
            .sub-box-title {
                text-align: center;
            }
        }

        .loader-container, .error-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }
        .w-16 { width: 4rem; }
        .h-16 { height: 4rem; }
        .border-4 { border-width: 4px; }
        .border-purple-200 { border-color: #e9d5ff; }
        .border-l-purple-600 { border-left-color: #6c1e74; }
        .rounded-full { border-radius: 9999px; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        .text-red-600 { color: #dc2626; }
        .bg-red-50 { background-color: #fef2f2; }
        .border-red-300 { border-color: #fca5a5; }
        .text-red-500 { color: #ef4444; }
        .bg-yellow-50 { background-color: #fffbeb; }
        .border-yellow-300 { border-color: #fde68a; }
        .text-yellow-600 { color: #d97706; }
    </style>
</head>
<body>
<div id="root"></div>

<script>
    const { useState, useEffect, useRef } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;
    const { Users, CalendarClock, CloudDownload, BarChart2, FileSpreadsheet } = lucide;

    // Use the online published Google Sheets URLs as requested
    const OVERVIEW_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT9p5Y3pAPNizOEYtkCm4afSajXjCIleDobCAbzQ3-VfSAMD3Mn2VsyCXDQgCZ-RpGtRVqhnxBgU8hE/pub?gid=2143739256&single=true&output=csv';
    const DAILY_METRICS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR5ve6vqp96t9mWt-s2DF1vzLPlamk3JskBjjrvEwB-K3HgaVpmYZcnPN11nzKSeFJ0QGa9AsCvGWyE/pub?gid=0&single=true&output=csv';

    const App = () => {
        // State variables to hold the raw CSV data
        const [overviewData, setOverviewData] = useState([]);
        const [dailyMetricsData, setDailyMetricsData] = useState([]);
        // State variables for application status and error handling
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        // Refs for scrolling to sections
        const overviewRef = useRef(null);
        const dailyMetricsRef = useRef(null);
        const settingsRef = useRef(null);
        
        const sectionRefs = {
            'overview-section': overviewRef,
            'daily-section': dailyMetricsRef,
            'settings-section': settingsRef
        };

        /**
         * Fetches CSV data from a given URL with retries and robust error handling.
         * This function is crucial for ensuring data is loaded from the online source.
         * @param {string} url The URL of the CSV file.
         * @param {number} retries The number of times to retry on failure.
         * @param {number} delay The initial delay in milliseconds for exponential backoff.
         * @returns {Promise<string|null>} The CSV data as a string, or null on failure.
         */
        const fetchCSVData = async (url, retries = 3, delay = 1000) => {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        if (response.status === 404) {
                            throw new Error(`The requested file at URL ${url} was not found (404).`);
                        }
                        throw new Error(`HTTP error! status: ${response.status} for URL ${url}`);
                    }
                    const text = await response.text();
                    // Google Sheets can return an "empty" page with this text
                    if (text.includes("Sorry, the file you have requested does not exist.")) {
                        throw new Error("The Google Sheets URL is invalid or the file does not exist.");
                    }
                    return text;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error.message);
                    if (i < retries - 1) {
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                    } else {
                        // Throw the error on the last attempt
                        throw error;
                    }
                }
            }
            return null;
        };

        /**
         * Parses a CSV string into an array of objects.
         * @param {string} csv The CSV data as a string.
         * @returns {Array<Object>} An array of objects representing the CSV data.
         */
        const parseCSV = (csv) => {
            if (!csv) return [];
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return [];
            const headers = lines[0].split(',').map(header => header.trim());
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                // Use a regex to handle commas inside double quotes
                const values = line.match(/(?:"[^"]*"|[^,])+/g) || line.split(',');
                const trimmedValues = values.map(value => value.trim().replace(/"/g, ''));
                if (trimmedValues.length === headers.length) {
                    const obj = {};
                    for (let j = 0; j < headers.length; j++) obj[headers[j]] = trimmedValues[j];
                    data.push(obj);
                } else {
                    console.warn(`Skipping malformed row: ${line}`);
                }
            }
            return data;
        };

        // Main effect to fetch data on component mount, as per your request
        useEffect(() => {
            const initializeDashboard = async () => {
                setLoading(true);
                setError(null);
                try {
                    const [overviewCsv, dailyMetricsCsv] = await Promise.all([
                        fetchCSVData(OVERVIEW_URL),
                        fetchCSVData(DAILY_METRICS_URL)
                    ]);
                    // Check if data was fetched successfully before parsing
                    if (overviewCsv) setOverviewData(parseCSV(overviewCsv));
                    if (dailyMetricsCsv) setDailyMetricsData(parseCSV(dailyMetricsCsv));
                    
                } catch (e) {
                    console.error("Failed to load data:", e);
                    setError("Failed to load data. Please check the data sources and your network connection. Error: " + e.message);
                } finally {
                    setLoading(false);
                }
            };
            initializeDashboard();
        }, []);

        const scrollToRef = (ref) => {
            if (ref && ref.current) ref.current.scrollIntoView({ behavior: 'smooth' });
        };
        
        const handleNavClick = (sectionId) => {
            const ref = sectionRefs[sectionId];
            scrollToRef(ref);
        };

        // Memoized data processing functions for better performance
        const processOverviewData = React.useMemo(() => {
            return overviewData.reduce((acc, row) => {
                const topLevelBox = row['Top-Level Box'];
                const subBoxHeader = row['Sub-Box Header'];
                if (!acc[topLevelBox]) acc[topLevelBox] = {};
                if (!acc[topLevelBox][subBoxHeader]) acc[topLevelBox][subBoxHeader] = [];
                acc[topLevelBox][subBoxHeader].push(row);
                return acc;
            }, {});
        }, [overviewData]);

        const scorecards = React.useMemo(() => {
            const dau = dailyMetricsData.find(d => d['Cumulative'] === 'DAU')?.WEB || 'NA';
            const mau = dailyMetricsData.find(d => d['Cumulative'] === 'MAU')?.WEB || 'NA';
            const visitors = dailyMetricsData.find(d => d['Cumulative'] === 'Total Visitors')?.WEB || 'NA';
            return { dau, mau, visitors };
        }, [dailyMetricsData]);

        const dailyMetricsSubBoxes = React.useMemo(() => {
            return dailyMetricsData.filter(metric =>
                !['Cumulative', 'DAU', 'MAU', 'Active Users', 'Total Visitors'].includes(metric['Cumulative']) &&
                metric['Cumulative'] && metric['Cumulative'].trim() !== ''
            );
        }, [dailyMetricsData]);


        const mockDauChartData = [
            { name: 'Mon', users: 1600 },
            { name: 'Tue', users: 1650 },
            { name: 'Wed', users: 1750 },
            { name: 'Thu', users: 1800 },
            { name: 'Fri', users: 1780 },
            { name: 'Sat', users: 1700 },
            { name: 'Sun', users: 1690 },
        ];
        
        // This function handles the conditional rendering based on the app's state
        const renderContent = () => {
            if (loading) {
                return React.createElement('div', { className: 'loader-container' },
                    React.createElement('div', { className: 'w-16 h-16 border-4 border-purple-200 border-l-purple-600 rounded-full animate-spin' })
                );
            }
            if (error) {
                return React.createElement('div', { className: 'error-container' },
                    React.createElement('div', { className: 'text-center p-8 bg-red-50 border border-red-300 rounded-2xl shadow-lg max-w-lg mx-auto' },
                        React.createElement('h3', { className: 'text-2xl font-bold text-red-600 mb-4' }, 'Data Loading Error'),
                        React.createElement('p', { className: 'text-lg text-red-500' }, error),
                        React.createElement('p', { className: 'text-sm text-gray-500 mt-4' }, 'Please ensure the Google Sheets are publicly accessible via the provided links and try again.')
                    )
                );
            }
            if (Object.keys(processOverviewData).length === 0 && dailyMetricsData.length === 0) {
                 return React.createElement('div', { className: 'error-container' },
                    React.createElement('div', { className: 'text-center p-8 bg-yellow-50 border border-yellow-300 rounded-2xl shadow-lg max-w-lg mx-auto' },
                        React.createElement('h3', { className: 'text-2xl font-bold text-yellow-600 mb-4' }, 'No Data Available'),
                        React.createElement('p', { className: 'text-lg text-yellow-500' }, 'The dashboard could not load any data. Please check the source URLs.')
                    )
                );
            }

            return React.createElement(React.Fragment, null,
                React.createElement('section', { id: 'overview-section', ref: overviewRef, className: 'pt-24 pb-8' },
                    React.createElement('div', { className: 'top-level-box' },
                        React.createElement('h2', { className: 'top-level-box-title' }, 'Overview Metrics'),
                        Object.entries(processOverviewData).map(([topLevelBox, subBoxes]) => (
                            React.createElement('div', { key: topLevelBox, className: 'mb-8' },
                                React.createElement('h3', { className: 'text-2xl font-semibold text-gray-800 mb-4' }, topLevelBox),
                                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                                    Object.entries(subBoxes).map(([subBoxHeader, metrics]) => (
                                        React.createElement('div', { key: subBoxHeader, className: 'sub-box' },
                                            React.createElement('h4', { className: 'sub-box-title' }, subBoxHeader),
                                            React.createElement('div', { className: 'space-y-2' },
                                                metrics.sort((a, b) => parseInt(a['Order']) - parseInt(b['Order'])).map((metric, index) => (
                                                    React.createElement('div', { key: index, className: 'metric-item' },
                                                        React.createElement('span', { className: 'metric-label' }, metric['Data Header']),
                                                        React.createElement('span', { className: 'metric-value' }, metric['Value'])
                                                    )
                                                ))
                                            )
                                        )
                                    ))
                                )
                            )
                        ))
                    )
                ),
                React.createElement('section', { id: 'daily-section', ref: dailyMetricsRef, className: 'py-8' },
                    React.createElement('div', { className: 'top-level-box' },
                        React.createElement('h2', { className: 'top-level-box-title' }, 'Daily Metrics'),
                        React.createElement('div', { className: 'scorecard-grid mb-8' },
                            React.createElement('div', { className: 'scorecard' },
                                React.createElement('div', { className: 'scorecard-icon' }, React.createElement(Users, { className: 'w-7 h-7' })),
                                React.createElement('div', { className: 'scorecard-content' },
                                    React.createElement('h3', null, 'Daily Active Users'),
                                    React.createElement('p', null, scorecards.dau)
                                )
                            ),
                            React.createElement('div', { className: 'scorecard' },
                                React.createElement('div', { className: 'scorecard-icon' }, React.createElement(CalendarClock, { className: 'w-7 h-7' })),
                                React.createElement('div', { className: 'scorecard-content' },
                                    React.createElement('h3', null, 'Monthly Active Users'),
                                    React.createElement('p', null, scorecards.mau)
                                )
                            ),
                            React.createElement('div', { className: 'scorecard' },
                                React.createElement('div', { className: 'scorecard-icon' }, React.createElement(CloudDownload, { className: 'w-7 h-7' })),
                                React.createElement('div', { className: 'scorecard-content' },
                                    React.createElement('h3', null, 'Total Visitors'),
                                    React.createElement('p', null, scorecards.visitors)
                                )
                            )
                        ),
                        React.createElement('div', { className: 'chart-container mb-8' },
                            React.createElement('h3', { className: 'top-level-box-title !mb-4 !pb-2' }, 'Daily Active Users Trend'),
                            React.createElement(ResponsiveContainer, { width: '100%', height: 320 },
                                React.createElement(LineChart, { data: mockDauChartData },
                                    React.createElement(CartesianGrid, { strokeDasharray: '3 3', strokeOpacity: 0.5 }),
                                    React.createElement(XAxis, { dataKey: 'name', stroke: '#6c1e74' }),
                                    React.createElement(YAxis, { stroke: '#6c1e74' }),
                                    React.createElement(Tooltip, {
                                        contentStyle: {
                                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(108, 30, 116, 0.2)',
                                            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.1)',
                                            backdropFilter: 'blur(10px)',
                                            color: '#374151'
                                        },
                                        itemStyle: { color: '#6c1e74' }
                                    }),
                                    React.createElement(Line, { type: 'monotone', dataKey: 'users', stroke: '#6c1e74', strokeWidth: 2, dot: { r: 4 }, activeDot: { r: 6 } })
                                )
                            )
                        ),
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                            dailyMetricsSubBoxes.map((metric, index) => (
                                React.createElement('div', { key: index, className: 'sub-box' },
                                    React.createElement('h4', { className: 'sub-box-title' }, metric['Cumulative']),
                                    React.createElement('div', { className: 'space-y-2' },
                                        ['WEB', 'ANDROID', 'iOS'].map(platform => (
                                            metric[platform] && metric[platform] !== 'NA' && metric[platform].trim() !== '' ?
                                                React.createElement('div', { key: platform, className: 'metric-item' },
                                                    React.createElement('span', { className: 'metric-label' }, platform),
                                                    React.createElement('span', { className: 'metric-value' }, metric[platform])
                                                ) : null
                                        ))
                                    )
                                )
                            ))
                        )
                    )
                ),
                React.createElement('section', { id: 'settings-section', ref: settingsRef, className: 'py-8' },
                    React.createElement('div', { className: 'top-level-box' },
                        React.createElement('h2', { className: 'top-level-box-title' }, 'Settings'),
                        React.createElement('p', { className: 'text-gray-600' }, 'This section is a placeholder for user settings.')
                    )
                ),
                React.createElement('footer', { className: 'last-updated-text py-8' }, 'Last updated: ' + new Date().toLocaleString())
            );
        };
        
        const Sidebar = ({ onNavClick }) => {
            const [activeSection, setActiveSection] = useState('overview-section');
            const handleSectionClick = (sectionId) => {
              setActiveSection(sectionId);
              onNavClick(sectionId);
            };

            return React.createElement('aside', { className: 'sidebar' },
                React.createElement('div', { className: 'sidebar-logo' }, 'Dashboard'),
                React.createElement('nav', null,
                    React.createElement('a', { onClick: () => handleSectionClick('overview-section'), className: `sidebar-nav-item ${activeSection === 'overview-section' ? 'active' : ''}` }, React.createElement(Users, { className: 'w-6 h-6' }), ' Overview'),
                    React.createElement('a', { onClick: () => handleSectionClick('daily-section'), className: `sidebar-nav-item ${activeSection === 'daily-section' ? 'active' : ''}` }, React.createElement(BarChart2, { className: 'w-6 h-6' }), ' Daily Metrics'),
                    React.createElement('a', { onClick: () => handleSectionClick('settings-section'), className: `sidebar-nav-item ${activeSection === 'settings-section' ? 'active' : ''}` }, React.createElement(FileSpreadsheet, { className: 'w-6 h-6' }), ' Settings')
                )
            );
        };

        return React.createElement(React.Fragment, null,
            React.createElement('div', { className: 'dashboard-container' },
                React.createElement(Sidebar, { onNavClick: handleNavClick }),
                React.createElement('main', { className: 'main-content' }, renderContent())
            )
        );
    };

    const renderApp = () => {
        const rootElement = document.getElementById('root');
        if (rootElement) {
            ReactDOM.createRoot(rootElement).render(React.createElement(App, null));
        } else {
            console.error("Root element with id 'root' not found.");
        }
    };

    // Use DOMContentLoaded for reliable and fast rendering
    document.addEventListener('DOMContentLoaded', renderApp);
</script>
</body>
</html>
